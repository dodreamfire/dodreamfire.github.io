<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>두드림소방 일정관리</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./dodreamfirelogo.PNG">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
    header { display:flex; align-items:center; background:#0055a5; color:white; padding:10px; }
    header img { height:40px; margin-right:10px; }
    main { padding:20px; }
    .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; }
    .day { background:white; padding:5px; border:1px solid #ccc; min-height:50px; position:relative; }
    .memo { background:#e1f5fe; margin:2px 0; padding:2px 5px; border-radius:3px; font-size:12px; display:flex; justify-content:space-between; }
    .deleteBtn { background:red; color:white; border:none; padding:0 5px; font-size:10px; cursor:pointer; border-radius:3px; margin-left:5px; }
    #memoInput { width:80%; padding:5px; }
    #addMemoBtn { padding:5px; }
  </style>
</head>
<body>

<header>
  <img src="./dodreamfirelogo.PNG" alt="두드림소방 로고">
  <h1>두드림소방 일정관리</h1>
</header>

<main>
  <label for="monthSelect">월 선택:</label>
  <input type="month" id="monthSelect" min="2025-08" max="2030-08">
  <div class="calendar" id="calendar"></div>

  <div style="margin-top:10px;">
    <input type="text" id="memoInput" placeholder="메모 입력">
    <button id="addMemoBtn">추가</button>
  </div>
</main>

<!-- Firebase SDK (compat 버전) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAaAeWf8x-TVUBcM8YuDYaJ1k3da0J7KXI",
    authDomain: "dodreamfire.firebaseapp.com",
    projectId: "dodreamfire",
    storageBucket: "dodreamfire.appspot.com",
    messagingSenderId: "36503811647",
    appId: "1:36503811647:web:4c19ffa3dcb337dfed6a8a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const calendarEl = document.getElementById("calendar");
  const monthSelect = document.getElementById("monthSelect");
  const memoInput = document.getElementById("memoInput");
  const addMemoBtn = document.getElementById("addMemoBtn");

  // 오늘 날짜로 초기 설정
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = (today.getMonth()+1).toString().padStart(2,'0');
  monthSelect.value = `${yyyy}-${mm}`;

  function renderCalendar(year, month){
    calendarEl.innerHTML = "";
    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month+1, 0).getDate();

    for(let i=0;i<firstDay;i++){
      const empty = document.createElement("div");
      calendarEl.appendChild(empty);
    }

    for(let day=1; day<=lastDate; day++){
      const dayEl = document.createElement("div");
      dayEl.className="day";
      dayEl.dataset.day = day;

      const dayLabel = document.createElement("div");
      dayLabel.textContent=day;
      dayEl.appendChild(dayLabel);

      // 메모 불러오기
      db.collection("memos")
        .where("year","==",year)
        .where("month","==",month)
        .where("day","==",day)
        .get()
        .then(snapshot=>{
          snapshot.forEach(doc=>{
            const data = doc.data();
            const memoEl = document.createElement("div");
            memoEl.className="memo";
            memoEl.textContent=data.text;

            const delBtn = document.createElement("button");
            delBtn.className="deleteBtn";
            delBtn.textContent="X";
            delBtn.onclick = ()=>{
              db.collection("memos").doc(doc.id).delete();
              memoEl.remove();
            }

            memoEl.appendChild(delBtn);
            dayEl.appendChild(memoEl);
          });
        });

      calendarEl.appendChild(dayEl);
    }
  }

  function addMemo(){
    const val = memoInput.value.trim();
    if(!val) return;
    const selected = monthSelect.value.split("-");
    const y = parseInt(selected[0]);
    const m = parseInt(selected[1])-1;
    const d = 1; // 기본 1일
    db.collection("memos").add({year:y, month:m, day:d, text:val});
    memoInput.value="";
    renderCalendar(y,m);
  }

  addMemoBtn.onclick = addMemo;

  monthSelect.onchange = ()=>{
    const val = monthSelect.value.split("-");
    const y = parseInt(val[0]);
    const m = parseInt(val[1])-1;
    renderCalendar(y,m);
  }

  renderCalendar(today.getFullYear(), today.getMonth());
</script>
</body>
</html>
