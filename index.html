<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>두드림소방 일정관리 (월별/일별 메모)​​</title>
  <meta name="description" content="두드림소방 일정관리 - 2025.8 ~ 2030.8 월 선택, 일별 다중 메모 저장 및 캘린더 셀 내 표시" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#d62828;
      --accent:#f77f00;
      --bg:#fbfbfb;
      --card:#fff;
      --muted:#666;
      --cell-height:120px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);
      color:#222;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:18px;
    }

    /* header */
    header{
      width:100%;
      max-width:1100px;
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }
    header img{height:48px; width:auto}
    header h1{margin:0; color:var(--brand); font-size:1.5rem}

    /* month select */
    #monthSelectContainer{width:100%; max-width:1100px; margin-bottom:14px}
    #monthSelect{
      width:100%;
      padding:10px 12px;
      font-size:1.05rem;
      border-radius:8px;
      border:1.5px solid #ccc;
      background:white;
    }

    /* layout: calendar left (or full width on mobile), memo area below or right */
    .layout{
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
      align-items:start;
    }

    /* calendar */
    table#calendar{
      width:100%;
      border-collapse:collapse;
      background:var(--card);
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      border-radius:10px;
      overflow:hidden;
      table-layout:fixed;
    }
    #calendar thead th{
      background:var(--brand);
      color:#fff;
      padding:10px 6px;
      font-weight:700;
      font-size:0.95rem;
    }
    #calendar td{
      vertical-align:top;
      border:1px solid #eee;
      padding:8px;
      height:var(--cell-height);
      position:relative;
      cursor:pointer;
      overflow:hidden;
      background:transparent;
    }
    #calendar td:focus{outline:3px solid rgba(214,40,40,0.12)}
    #calendar td:hover{background:#fff6f6}
    .date-number{font-weight:700; margin-bottom:6px; display:block}
    .today{box-shadow:inset 0 0 0 3px rgba(214,40,40,0.08); border-radius:6px}
    .selected{border:3px solid var(--brand); background: #fff0f0}

    /* cell memos */
    .cell-memos{
      font-size:0.78rem;
      color:#333;
      line-height:1.1;
      max-height: calc(var(--cell-height) - 28px);
      overflow:auto;
      padding-right:6px;
    }
    .cell-memos div{
      padding:3px 0;
      border-radius:4px;
      background:rgba(0,0,0,0.02);
      margin-bottom:4px;
      word-break:break-word;
    }
    .memo-dot{
      width:8px;height:8px;background:var(--brand);border-radius:50%;
      position:absolute; right:8px; bottom:8px;
    }

    /* memo panel */
    #memoArea{
      background:var(--card);
      border-radius:10px;
      padding:18px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      min-height:220px;
    }
    #memoArea h3{margin:0 0 12px 0; color:var(--brand)}
    #selectedDateDisplay{font-weight:700; color:var(--brand)}
    #memoList{list-style:none; padding:0; margin:0 0 12px 0; max-height:260px; overflow:auto; border:1px solid #eee; border-radius:8px}
    #memoList li{padding:10px 56px 10px 12px; border-bottom:1px solid #f0f0f0; position:relative; word-break:break-word}
    #memoList li:last-child{border-bottom:none}
    .del-btn{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      background:var(--brand); color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-weight:700
    }
    .del-btn:hover{background:#a32121}

    textarea#newMemo{
      width:100%; min-height:90px; resize:vertical; padding:10px 12px; border-radius:8px; border:1.2px solid #ccc; font-size:1rem;
    }
    #addMemoBtn{
      margin-top:10px; float:right; background:var(--brand); color:white; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:700
    }
    #addMemoBtn:hover{background:#a32121}

    footer{margin-top:20px; color:#666; font-size:0.9rem}

    /* responsive: single column under 980px */
    @media (max-width:980px){
      .layout{grid-template-columns: 1fr; padding-bottom:20px}
      #memoArea{order:2}
      table#calendar{order:1}
    }
    @media (max-width:520px){
      :root{--cell-height:100px}
      header h1{font-size:1.2rem}
      #monthSelect{font-size:0.98rem}
    }

    /* scrollbar small style for memos */
    .cell-memos::-webkit-scrollbar, #memoList::-webkit-scrollbar{height:8px;width:8px}
    .cell-memos::-webkit-scrollbar-thumb, #memoList::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.12);border-radius:6px}
  </style>
</head>
<body>

  <header>
    <img src="두드림소방로고.PNG" alt="두드림소방 로고" onerror="this.style.display='none'">
    <h1>두드림소방 일정관리</h1>
  </header>

  <div id="monthSelectContainer">
    <select id="monthSelect" aria-label="월 선택" ></select>
  </div>

  <div class="layout">
    <div>
      <table id="calendar" role="grid" aria-label="달력">
        <!-- 렌더링됨 -->
      </table>
    </div>

    <aside id="memoArea" aria-live="polite">
      <h3>선택한 날짜 메모 <span id="selectedDateDisplay"></span></h3>
      <ul id="memoList"><li>날짜를 선택하세요.</li></ul>

      <label for="newMemo" style="display:block;margin:8px 0 6px 0;font-weight:700;color:var(--muted)">새 메모</label>
      <textarea id="newMemo" placeholder="예) 점검 일정, 현장 메모 등" aria-label="새 메모"></textarea>
      <button id="addMemoBtn" onclick="addMemo()" aria-label="메모 추가">메모 추가</button>
      <div style="clear:both"></div>
    </aside>
  </div>

  <footer>
    © 2025 두드림소방 · 전화 0507-1394-5324 · dodreamfire@naver.com
  </footer>

<script>
/*
  통합 캘린더+다중메모 (셀 내부에 모든 메모 표시)
  - 월 범위: 2025-08 ~ 2030-08
  - localStorage key: 'dodream_calendar_memos_v1'
  - dateKey: "YYYY-M-D" (month and day not zero-padded)
*/

const STORAGE_KEY = 'dodream_calendar_memos_v1';
const startYear = 2025, startMonth = 8;
const endYear = 2030, endMonth = 8;

let memos = {};       // { "2025-8-10": ["a","b"], ... }
let selectedDate = null;
const today = new Date();

// helper load/save
function loadMemos(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    memos = raw ? JSON.parse(raw) : {};
  }catch(e){ memos = {}; }
}
function saveMemos(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(memos)); }

// fill month select (2025.8 ~ 2030.8)
function fillMonthSelect(){
  const sel = document.getElementById('monthSelect');
  sel.innerHTML = '';
  for(let y = startYear; y <= endYear; y++){
    let mStart = (y === startYear) ? startMonth : 1;
    let mEnd = (y === endYear) ? endMonth : 12;
    for(let m = mStart; m <= mEnd; m++){
      const opt = document.createElement('option');
      opt.value = `${y}-${m}`;
      opt.textContent = `${y}년 ${m}월`;
      sel.appendChild(opt);
    }
  }
  // default: 현재 월이 범위 안이면 현재, 아니면 시작월
  const todayVal = `${today.getFullYear()}-${today.getMonth()+1}`;
  const within = (()=> {
    const [ty,tm] = todayVal.split('-').map(Number);
    if(ty < startYear || ty > endYear) return false;
    if(ty === startYear && tm < startMonth) return false;
    if(ty === endYear && tm > endMonth) return false;
    return true;
  })();
  sel.value = within ? todayVal : `${startYear}-${startMonth}`;
  sel.addEventListener('change', onMonthChange);
}

// build calendar for year,month (month is 1..12)
function buildCalendar(year, month){
  selectedDate = null;
  document.getElementById('selectedDateDisplay').textContent = '';
  document.getElementById('newMemo').value = '';

  const firstDay = new Date(year, month-1, 1);
  const lastDay = new Date(year, month, 0);
  const calendar = document.getElementById('calendar');

  // header row + body start
  let html = '<thead><tr><th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th></tr></thead><tbody><tr>';

  // empty cells before first
  for(let i=0;i<firstDay.getDay();i++) html += '<td></td>';

  for(let d=1; d<= lastDay.getDate(); d++){
    const key = `${year}-${month}-${d}`;
    const list = memos[key] || [];
    const isToday = (year === today.getFullYear() && month === today.getMonth()+1 && d === today.getDate());
    // cell open
    let classes = '';
    if(list.length) classes += ' hasMemo';
    if(isToday) classes += ' today';
    html += `<td class="${classes.trim()}" tabindex="0" role="gridcell"
      aria-label="${d}일 ${list.length?(', 메모 '+list.length+'개'):''}${isToday? ', 오늘':''}"
      onclick="cellClick(this,${year},${month},${d})"
      onkeydown="if(event.key==='Enter'||event.key===' ') cellClick(this,${year},${month},${d})"
    style="position:relative;">`;
    html += `<div class="date-number">${d}</div>`;

    // show all memos in cell (wrapping, scroll if many)
    if(list.length){
      html += `<div class="cell-memos">`;
      for(let m of list){
        // escape minimal
        const esc = (s)=> s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
        html += `<div title="${esc(m)}">${esc(m)}</div>`;
      }
      html += `</div>`;
      html += `<div class="memo-dot" title="메모 있음"></div>`;
    }

    html += `</td>`;

    // new row if week end
    if((firstDay.getDay() + d) % 7 === 0 && d !== lastDay.getDate()){
      html += '</tr><tr>';
    }
  }

  // fill trailing empties
  const remaining = (7 - (firstDay.getDay() + lastDay.getDate()) % 7) % 7;
  for(let i=0;i<remaining;i++) html += '<td></td>';

  html += '</tr></tbody>';
  calendar.innerHTML = html;

  // after render, ensure small performance: attach no more events needed (we used inline handlers)
}

// cell click handler (called from inline)
function cellClick(td, y, m, d){
  // clear previous selection
  document.querySelectorAll('#calendar td').forEach(c=>c.classList.remove('selected'));
  td.classList.add('selected');

  selectedDate = `${y}-${m}-${d}`;
  document.getElementById('selectedDateDisplay').textContent = `(${selectedDate})`;
  renderMemoList();
  // scroll memo area into view on small screens
  if(window.innerWidth < 900){
    document.getElementById('memoArea').scrollIntoView({behavior:'smooth'});
  }
}

// render memo list in side panel
function renderMemoList(){
  const listEl = document.getElementById('memoList');
  listEl.innerHTML = '';
  if(!selectedDate){
    listEl.innerHTML = '<li>날짜를 선택하세요.</li>';
    return;
  }
  const arr = memos[selectedDate] || [];
  if(arr.length === 0){
    listEl.innerHTML = '<li>등록된 메모가 없습니다.</li>';
    return;
  }
  arr.forEach((text, idx) => {
    const li = document.createElement('li');
    li.textContent = text;
    const btn = document.createElement('button');
    btn.className = 'del-btn';
    btn.textContent = '삭제';
    btn.onclick = ()=> {
      if(confirm('메모를 삭제하시겠습니까?')){
        deleteMemo(idx);
      }
    };
    li.appendChild(btn);
    listEl.appendChild(li);
  });
}

// add memo (from textarea)
function addMemo(){
  if(!selectedDate){
    alert('먼저 날짜를 선택하세요.');
    return;
  }
  const ta = document.getElementById('newMemo');
  const val = ta.value.trim();
  if(!val){
    alert('메모 내용을 입력하세요.');
    ta.focus();
    return;
  }
  if(!memos[selectedDate]) memos[selectedDate] = [];
  memos[selectedDate].push(val);
  saveMemos();
  ta.value = '';
  renderMemoList();
  // update calendar cell content without re-rendering whole calendar for smoothness
  updateCellMemos(selectedDate);
}

// delete memo by index for selectedDate
function deleteMemo(idx){
  if(!selectedDate || !memos[selectedDate]) return;
  memos[selectedDate].splice(idx,1);
  if(memos[selectedDate].length === 0) delete memos[selectedDate];
  saveMemos();
  renderMemoList();
  updateCellMemos(selectedDate);
}

// update only the calendar cell content for a given dateKey to reflect new memos
function updateCellMemos(dateKey){
  // dateKey format "YYYY-M-D"
  const parts = dateKey.split('-').map(Number);
  const y = parts[0], m = parts[1], d = parts[2];
  // find the cell by scanning td with onclick attribute matching (best-effort)
  const tds = document.querySelectorAll('#calendar td');
  for(const td of tds){
    const on = td.getAttribute('onclick') || '';
    // onclick contains "cellClick(this,Y,M,D)"
    if(on.includes(`,${y},${m},${d}`) || on.includes(`(${y},${m},${d}`)){
      // rebuild inner html for that td
      const list = memos[dateKey] || [];
      let inner = `<div class="date-number">${d}</div>`;
      if(list.length){
        let cell = `<div class="cell-memos">`;
        for(const mtext of list){ const esc = mtext.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); cell += `<div title="${esc}">${esc}</div>`; }
        cell += `</div>`;
        inner += cell + `<div class="memo-dot" title="메모 있음"></div>`;
      }
      td.innerHTML = inner;
      break;
    }
  }
}

// month select change handler
function onMonthChange(e){
  const [y,m] = e.target.value.split('-').map(Number);
  buildCalendar(y,m);
  selectedDate = null;
  document.getElementById('selectedDateDisplay').textContent = '';
  document.getElementById('newMemo').value = '';
  renderMemoList();
}

// init
function init(){
  loadMemos();
  fillMonthSelect();
  // initial build
  const sel = document.getElementById('monthSelect');
  const [y,m] = sel.value.split('-').map(Number);
  buildCalendar(y,m);
  // keyboard accessibility: allow arrow navigation between months (optional)
  document.addEventListener('keydown', (ev)=>{
    if(ev.key === 'ArrowLeft'){ // prev month
      changeMonthRelative(-1);
    } else if(ev.key === 'ArrowRight'){
      changeMonthRelative(1);
    }
  });
}

// change selected month by relative offset (1 or -1)
function changeMonthRelative(offset){
  const sel = document.getElementById('monthSelect');
  const opts = Array.from(sel.options);
  const idx = opts.findIndex(o => o.value === sel.value);
  const newIdx = Math.max(0, Math.min(opts.length-1, idx + offset));
  if(newIdx !== idx){
    sel.selectedIndex = newIdx;
    sel.dispatchEvent(new Event('change'));
  }
}

init();
</script>
</body>
</html>
